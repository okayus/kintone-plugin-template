# kintone-plugin-template UI/UX改善実装計画

## 概要

kintone-conditional-flag-setterの実装を参考に、kintone-plugin-templateの設定画面にアプリ選択による動的フィールド更新機能を実装する。

## 現状分析

### 既存の実装
- react-jsonschema-formを使用した設定画面
- 単一アプリ（現在のアプリ）のフィールド選択のみ
- インポート/エクスポート機能は実装済み

### 必要な改善点
1. 複数アプリ選択機能の追加
2. アプリ選択に応じた動的なフィールド取得
3. 各設定項目の独立性確保（他の設定に影響しない）

## 実装計画

### Phase 1: 機能設計とスキーマ定義
1. **新しい設定構造の設計**
   - アプリIDとフィールドを紐づける設定項目の追加
   - 複数の設定を配列で管理する構造

2. **JSON Schemaの更新**
   - 新しい設定構造に対応したスキーマ定義
   - 型生成スクリプトの実行

### Phase 2: UI実装準備
1. **必要なコンポーネントの作成**
   - アプリ選択コンポーネント
   - 動的フィールド選択コンポーネント
   - 設定項目管理コンポーネント

2. **API統合**
   - アプリ一覧取得機能
   - 選択したアプリのフィールド取得機能
   - キャッシュ機能の実装

### Phase 3: 動的UI実装
1. **react-jsonschema-formのカスタマイズ**
   - カスタムウィジェットの作成
   - 動的スキーマ生成ロジック

2. **状態管理の実装**
   - アプリ選択状態の管理
   - フィールド選択状態の管理
   - 設定項目間の独立性確保

### Phase 4: テストと改善
1. **動作確認**
   - 複数設定項目の独立動作確認
   - アプリ切り替え時の動作確認

2. **UX改善**
   - ローディング状態の表示
   - エラーハンドリング

## 技術的な実装詳細

### 新しい設定構造（案）
```json
{
  "settings": [
    {
      "name": "設定1",
      "appId": "123",
      "targetField": "field_1",
      "prefix": "通知："
    },
    {
      "name": "設定2", 
      "appId": "456",
      "targetField": "field_2",
      "prefix": "アラート："
    }
  ]
}
```

### 主要な実装ポイント
1. **react-jsonschema-formでの動的フィールド実装**
   - カスタムウィジェットを使用してアプリ選択時にフィールドを動的更新
   - 各設定項目のインデックスを使用して独立性を保証

2. **キャッシュ戦略**
   - アプリ情報とフィールド情報をメモリにキャッシュ
   - 不要なAPI呼び出しを削減

3. **状態管理**
   - React hooksを使用した状態管理
   - useEffectで依存関係を適切に管理

## 実装スケジュール

1. **Day 1**: 機能設計とJSON Schema作成
2. **Day 2**: 基本的なUI実装
3. **Day 3**: 動的更新機能の実装
4. **Day 4**: テストと改善

## 参考実装

kintone-conditional-flag-setterの以下の実装を参考にする：
- `ConfigForm.tsx`: タブ管理と設定の独立性
- `ConditionForm.tsx`: アプリ選択による動的フィールド更新
- `cache.ts`: API呼び出しのキャッシュ管理

## ToDoリスト

- [ ] JSON Schemaの設計と作成
- [ ] 型定義の生成
- [ ] カスタムウィジェットの作成
- [ ] アプリ一覧取得機能の実装
- [ ] 動的フィールド取得機能の実装
- [ ] 設定項目の追加/削除機能
- [ ] 動作確認とバグ修正
- [ ] ドキュメント作成